# 1Passwordé€£æºç”¨GitHub Actionsè¨­å®šä¾‹
# æ³¨æ„: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯å‚è€ƒä¾‹ã§ã™ã€‚å®Ÿéš›ã®ä½¿ç”¨æ™‚ã¯é©åˆ‡ãªsecretsã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

name: 1Password Integration Example

on:
  workflow_dispatch: # æ‰‹å‹•å®Ÿè¡Œç”¨
  # push:
  #   branches: [ main, dev ]
  # pull_request:
  #   branches: [ main ]

jobs:
  # ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºè€…å‘ã‘ã®ã‚¬ã‚¤ãƒ€ãƒ³ã‚¹
  setup-guide:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    
    steps:
      - name: 1Password CLI Setup Guide
        run: |
          echo "ğŸ” 1Password CLI Setup Guide"
          echo "================================"
          echo ""
          echo "ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã®1Password CLIä½¿ç”¨æ–¹æ³•:"
          echo "1. brew install 1password-cli"
          echo "2. 1Passwordã‚¢ãƒ—ãƒªã§ CLIçµ±åˆã‚’æœ‰åŠ¹åŒ–"
          echo "3. op signin --account my.1password.com"
          echo "4. npm run dev:secure"
          echo ""
          echo "åˆ©ç”¨å¯èƒ½ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆ:"
          echo "- npm run dev:secure     # ç§˜å¯†æƒ…å ±ä»˜ãã§é–‹ç™ºé–‹å§‹"
          echo "- npm run build:secure   # ç§˜å¯†æƒ…å ±ä»˜ãã§ãƒ“ãƒ«ãƒ‰"
          echo "- npm run test:secure    # ç§˜å¯†æƒ…å ±ä»˜ãã§ãƒ†ã‚¹ãƒˆ"
          echo "- npm run secrets:validate # 1Passwordæ¥ç¶šç¢ºèª"
          echo ""
          echo "è©³ç´°: docs/1PASSWORD_CLI_SETUP.md ã‚’å‚ç…§"

  # æœ¬ç•ªç’°å¢ƒå‘ã‘ã®ç’°å¢ƒå¤‰æ•°ãƒã‚§ãƒƒã‚¯ä¾‹
  validate-secrets:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4

      - name: Validate Required Secrets
        run: |
          echo "ğŸ” Required Secrets Validation"
          echo "=============================="
          
          # å¿…è¦ãªç’°å¢ƒå¤‰æ•°ã®ãƒªã‚¹ãƒˆï¼ˆå®Ÿéš›ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«åˆã‚ã›ã¦èª¿æ•´ï¼‰
          REQUIRED_VARS=(
            "NEXTAUTH_SECRET"
            "DATABASE_URL"
            "SENDGRID_API_KEY"
            "STRIPE_SECRET_KEY"
          )
          
          echo "ä»¥ä¸‹ã®ç’°å¢ƒå¤‰æ•°ãŒGitHub Secretsã§è¨­å®šã•ã‚Œã¦ã„ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™:"
          for var in "${REQUIRED_VARS[@]}"; do
            echo "- $var"
          done
          
          echo ""
          echo "è¨­å®šæ–¹æ³•:"
          echo "1. GitHub Repository â†’ Settings â†’ Secrets and variables â†’ Actions"
          echo "2. New repository secret ã‚’ã‚¯ãƒªãƒƒã‚¯"
          echo "3. å„å¤‰æ•°ã‚’1Passwordã‹ã‚‰å–å¾—ã—ã¦è¨­å®š"
          
          echo ""
          echo "ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã§ã¯ 'npm run dev:secure' ã§1Password CLIã‹ã‚‰è‡ªå‹•å–å¾—"

  # TypeScriptå‹ãƒã‚§ãƒƒã‚¯ï¼ˆç§˜å¯†æƒ…å ±ãªã—ã§å®Ÿè¡Œå¯èƒ½ï¼‰
  type-check:
    runs-on: ubuntu-latest
    if: github.event_name == 'workflow_dispatch'
    
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18'
          cache: 'npm'
          
      - name: Install dependencies
        run: npm ci
        
      - name: Type check
        run: npm run type-check

# æœ¬ç•ªç’°å¢ƒç”¨ã®è¨­å®šä¾‹ï¼ˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆï¼‰
# production-deploy:
#   runs-on: ubuntu-latest
#   if: github.ref == 'refs/heads/main'
#   
#   steps:
#     - name: Checkout
#       uses: actions/checkout@v4
#     
#     - name: Setup Node.js
#       uses: actions/setup-node@v4
#       with:
#         node-version: '18'
#         cache: 'npm'
#     
#     - name: Install dependencies
#       run: npm ci
#     
#     - name: Build with secrets
#       env:
#         NEXTAUTH_SECRET: ${{ secrets.NEXTAUTH_SECRET }}
#         DATABASE_URL: ${{ secrets.DATABASE_URL }}
#         SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}
#         STRIPE_SECRET_KEY: ${{ secrets.STRIPE_SECRET_KEY }}
#         # ãã®ä»–å¿…è¦ãªç’°å¢ƒå¤‰æ•°
#       run: npm run build
#     
#     - name: Deploy to Vercel
#       uses: amondnet/vercel-action@v25
#       with:
#         vercel-token: ${{ secrets.VERCEL_TOKEN }}
#         vercel-org-id: ${{ secrets.VERCEL_ORG_ID }}
#         vercel-project-id: ${{ secrets.VERCEL_PROJECT_ID }}
#         vercel-args: '--prod'