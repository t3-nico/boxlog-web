# BoxLog における NBD モデルと関連数学ツールのまとめ

以下では、これまでの会話で扱ってきた「プレファレンス（好み／好き度）」「ポアソン分布」「負の二項分布（NBD モデル）」などの基礎概念から、BoxLog（オンラインのタスク管理アプリ）への応用、そして「6 つの数学ツール（モデル）の活用方法」までを、Markdown 形式で網羅的にまとめます。非常に長文ではありますが、今後の資料化やドキュメントとしてそのままご活用いただけるよう、可能な限り丁寧に記述しています。

---

## 1. はじめに：プレファレンスと売上モデルの全体像

1. **プレファレンス（好み／好き度）とは？**  
   - 個々の消費者（ユーザー）の頭の中にある「どのブランドをどれだけ使ってみたいか」という度合いのこと。  
   - 例：ジュースの話では「A 社のオレンジジュースが好きか」「B 社のぶどうジュースが好きか」という感覚がプレファレンス。  
   - プレファレンスが高ければ高いほど、そのブランドの商品を選ぶ確率が上がり、最終的に売上（シェア）を押し上げる。  
   - 完全に認知され、いつでも手に入り、時間が十分にあるなら、「プレファレンス≒ユニットシェア（購入シェア）」になる。

2. **モデル化の流れ**  
   1. **二項分布**  
      - 「試行回数が固定されている中で、“成功” または “失敗” が起こる回数を確率的に扱う」モデル。  
      - 例：コインを 10 回投げて「表が何回出るか」を考える。  
      - ジュース購買に置き換えると、「10 人のうち何人がジュースを買うか」を確率で推定するイメージ。  
   2. **ポアソン分布**  
      - 「ある時間（またはある一定の母集団の範囲）の中で、平均どれくらい起こるか」がわかっていれば、「実際に何回起こるか」を扱えるモデル。  
      - 例：1 時間で平均 3 人が自動販売機に来るなら、0 人、1 人、2 人…の確率を計算できる。  
      - ジュース購買に置き換えると、「1 日にだいたい 50 本売れる自販機」で、午前中に何本売れるかを推定するイメージ。  
   3. **負の二項分布（NBD モデル）**  
      - ポアソン分布の考え方を応用しつつ、  
        1. **M（市場規模）**：そのカテゴリー全体でどれだけの人が購入を検討するか  
        2. **K（行動頻度の平均・ばらつき）**：購入者 1 人あたり平均何回購入するか、かつユーザー間のばらつき  
        3. **プレファレンス（ブランドを選ぶ確率比）**  
        4. **スイッチング（ブランド乗り換え）確率**  
      - というパラメーターを使って、あるユーザーが「何回購入するか」「どのブランドを選ぶか」までを高精度で予測できる。  
   4. **数式全体と解釈**  
      - NBD モデルの確率質量関数（PMF）として、  
        \[
        P_r \;=\; 
        \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)} \times \Bigl(\frac{M}{M + K}\Bigr)^r \times \Bigl(\frac{K}{M + K}\Bigr)^K
        \]
      - ここで  
        - \(r\)：ユーザーあたりの「起きる回数（購入回数／ログイン回数など）」  
        - \(M\)：市場規模（モデル化するカテゴリーにおいて、一定期間に購入を検討する潜在ユーザー数）  
        - \(K\)：形状パラメーター（行動頻度のばらつきを表す数）  
        - \(\Gamma(\cdot)\)：ガンマ関数（整数であれば階乗に相当）  
      - これを使うと、「\(r=0,1,2,\dots\) の確率分布」が一気に求まる。  
   5. **結論**  
      - これらをステップ順に学ぶことで、「プレファレンスがブランド売上の根本である」という直感を数式で裏付けられる。  
      - いきなり NBD の難しい数式に放り込まれる前に、まず二項分布→ポアソン分布→NBD と段階的に理解を深めるのが狙い。

---

## 2. BoxLog におけるモデルの置き換え

### 2.1 BoxLog の文脈で「プレファレンス」を考える

- **SaaS 競合環境**  
  - タスク管理アプリ市場には BoxLog を含め、複数のアプリが存在する。  
  - 各ユーザーが「複数の選択肢の中でどれを使おうか？」と迷ったときに、  
    1. UI/UX（見た目の使いやすさ）  
    2. 機能（タイムボクシングやログ記録などの独自機能）  
    3. 口コミ／評判  
    4. 価格／プラン体系  
    5. 広告やプロモーション  
  - といった要因が総合されて、「BoxLog を使いたい度（＝プレファレンス）」として表れる。  

- **プレファレンスの意味**  
  - もし「タスク管理アプリを試そう」と思っている人が 100,000 人いるとすれば、  
    - 50% が BoxLog を選び、  
    - 30% が競合 A を選び、  
    - 20% が競合 B を選ぶ、  
  - とすると、BoxLog のプレファレンス比は 0.50（50％）になる。  
  - 実際には、「すでに別のアプリを使っていた人が BoxLog に乗り換える」「新規に初めてタスク管理を始める」など多岐にわたるが、最終的に「BoxLog が選ばれる確率／比率」がプレファレンスとして扱われる。  

---

### 2.2 BoxLog における「M と K」の置き換え

| 数学モデル上のパラメーター | 投影先のイメージ（ジュースモデル）         | BoxLog への置き換え                           |
|----------------------------|-------------------------------------------|-----------------------------------------------|
| **M（市場規模／Scale）**     | その地域で「ジュースを買いに来る人の数」   | 毎月「タスク管理アプリを使おう」と考える潜在ユーザー数 |
| **K（形状パラメーター）**    | 1 人あたり平均「月に何本買うか」「購入頻度のばらつき」 | 1 人あたり平均「月に何回ログイン／タスク操作するか」「利用頻度のばらつき」 |
| **プレファレンス**           | 各ブランドを選ぶ確率比（例：A=60%、B=30%、C=10%） | 各タスク管理アプリ（BoxLog、競合 A、競合 B）を選ぶ確率比 |
| **r（発生回数）**            | ある人が「今月ジュースを r 回買う」         | あるユーザーが「今月 BoxLog に r 回ログインする」または「r 回タスク操作する」 |
| **デリシュレーS（スイッチング）** | 一定期間後に別ブランドに乗り換える確率       | 一定期間後に別アプリに乗り換える確率           |

- **M の具体例**  
  - 「毎月 100,000 人がタスク管理市場を調べる」というデータ（検索ボリュームや業界レポートなど）をもとに推定できる。  
- **K の具体例**  
  - データベース上の実績から「BoxLog 登録後 1 カ月目に平均で 8 回ログインする」「月ごとに 0 回〜100 回以上までばらつきがある」などを把握し、形状パラメーターとして数値化する。  
- **プレファレンスの具体例**  
  - Web アクセスログや広告クリック率、SNS の反応などをもとに、「BoxLog を使ってみたい人の推定数÷市場規模」で比率を求める。  
- **r の具体例**  
  - ユーザーごとに「月単位でのログイン回数」をテーブル化し、回数分布を集計する。  

---

### 2.3 BoxLog による「ポアソン分布」「NBD モデル」のイメージ

1. **ポアソン分布（簡易イメージ）**  
   - BoxLog 全体で「月間ログイン回数の合計」が 500,000 回だとする。  
   - 「月に 3 回ログインする確率」「月に 0 回（休眠する）確率」などを平均 λ＝（500,000 ÷ 月間アクティブユーザー数）から単純に計算できる。  
   - ただし、個々のユーザーごとのばらつきは反映されないため、「あくまで母集団として平均的な頻度分布をざっくり把握する」レベルにとどまる。

2. **負の二項分布（NBD モデル）のイメージ**  
   - 「母集団としてログイン行動を起こす人（＝M）」「その人が月に何回ログインするか（＝K）」「BoxLog を選ぶ確率（＝プレファレンス）」を組み合わせて、  
     - **ユーザーごとに「今月 r 回ログインする確率 \(P_r\) (r=0,1,2,\dots)」**  
     - を予測できるモデル。  
   - **ステップ：**  
     1. ユーザー全体の「月間ログイン回数分布」を確認 → 形状パラメーター \(K\) と平均スケール \(M\) を最尤推定で求める。  
     2. プレファレンス（BoxLog vs. 競合）を「市場調査」「検索データ」「アンケート」などで推定 → その比率をモデルに組み込む。  
     3. これにより「r 回（例：r=0,1,2,…10,20…）ログインする確率分布 \(P_r\)」を完全に数学的に求められる。  
   - **応用**  
     - 「今月 0 回（休眠）の確率が高いユーザー」はメールやプッシュ通知で復帰施策を打つ。  
     - 「月 10 回以上ログインするユーザー」が全体の何％かを計算し、「有料プラン転換率にかける」ことで売上予測に用いる。  
     - 「来月・半年後のアクティブ率」をシミュレーションし、UI 改善やキャンペーン効果を事前に評価する。  

---

## 3. 6 つの数学ツール（モデル）と BoxLog での活用イメージ

以下では、添付資料（画像）にもあった「ビジネスでよく用いる 6 つの数学ツール（モデル）」を改めて紹介しつつ、BoxLog にどう応用できるかを具体的に示します。

### 3.1 ガンマ・ポアソン・リーセンシー・モデル  
**（Gamma–Poisson Recency Model）**

- **モデル概要**  
  - ユーザーの「最終ログイン日（Recency）」「累計ログイン回数／利用頻度（Frequency）」をもとに、  
    - 「今どのユーザーに注力すべきか（再利用を働きかけるべきか）」  
    - 「今後、どれくらいログインしてくれそうか（LTV＝顧客生涯価値傾向）」  
  - を予測するモデル。  
  - ガンマ分布で「ユーザーの利用頻度のばらつき」を、ポアソン過程で「ある期間に再利用する確率」を推定する。

- **BoxLog への応用例**  
  1. **休眠リスクの予測（離脱予兆）**  
     - ユーザーごとに「最終ログインからの経過日数」「過去 3 か月のログイン回数」を計測し、  
       \[
       \text{再利用確率} = \int \text{Poisson}(\lambda)\,d\text{Gamma}(\alpha, \beta)
       \]
       の形で算出する。  
     - 結果として「来週中に再ログインしない確率が高いユーザー群」を抽出 → プッシュ通知やメールで復帰施策を打つ。  
  2. **LTV（顧客生涯価値）のざっくり推計**  
     - ガンマ・ポアソンのパラメーターをもとに「このユーザーは今後◯回くらいログインしそうか」を予測。  
     - それを「ログインあたりの平均収益」「無料→有料転換率」などと掛け合わせれば、おおまかな LTV が得られる。  

---

### 3.2 負の二項分布（NBD Model: Negative Binomial Distribution）  
- **モデル概要**  
  - 「ユーザーの月間ログイン／タスク操作回数分布」を、  
    - \(M\)：市場規模（タスク管理アプリを使おうとする潜在ユーザー数）  
    - \(K\)：行動頻度の平均・ばらつき（形状パラメーター）  
    - プレファレンス（BoxLog vs. 競合アプリの選択比率）  
  - を用いて推定するモデル。  
  - 必要に応じて「スイッチング確率（他アプリへの乗り換え）」も組み込める。

- **BoxLog への応用例**  
  1. **実ユーザーデータへのフィット**  
     - 過去ログイン回数分布（例：「月 0 回：10％」「月 1 回：15％」「月 2 回：20％…」）を取得し、  
     - \(\{K, M\}\) を最尤推定する。  
     - 「理論的な \(P(r)\)（NBD での確率）と実データの分布が近いか」を確認し、  
     - フィットが良いなら「BoxLog ユーザーの行動傾向＝このモデルで説明できる」となる。  
  2. **プラン設計・課金率のベンチマーク**  
     - 例：「月に 10 回以上ログインするユーザーのうち、30％ が有料プランに乗り換える」という仮説を置くと、  
       \[
       \text{月 10 回以上ログインする確率} 
       \;=\; \sum_{r=10}^{\infty} P_r(K,M)
       \]
     - これに 0.30 を掛ければ、「月次有料転換率のおおよその見込み」が出せる。  
  3. **スイッチング（競合への乗り換え）**  
     - NBD モデルに「デリシュレー S（スイッチング動向）」を組み込むと、  
     - 「BoxLog ユーザーのうち、何か月後に何％が競合 A に移るか」などをシミュレーション可能。  

---

### 3.3 カテゴリーの進出順位モデル（Order of Entry Model）  
- **モデル概要**  
  - 新しく生まれたカテゴリー（例：「タスク管理×タイムボクシング」）において、  
    - 「BoxLog が後発（3 番手）として参入した場合、どれくらいのシェアを獲得できるか？」  
  - 既存の競合（先発１番手、２番手）の規模やブランド力、オーガニック流入数などを入力し、  
  - 「BoxLog のマーケティング投資量」「参入時期」を変数としてシミュレーションできる。

- **BoxLog への応用例**  
  1. **競合リリースシミュレーション**  
     - 「市場全体の成長率 × 競合 A・B のユーザー数 × BoxLog の想定マーケティング予算」  
     - を入れることで、「3 年後に BoxLog が市場でどれくらいのシェアを取れるか」を推定。  
  2. **機能追加タイミングの検討**  
     - 先発企業 A・B がまだ持っていない「AI レコメンド機能」を BoxLog が投入するタイミングを変えてみると、  
       - 「参入後 6 カ月でブランド認知をどれだけ獲得できるか」  
       - 「競合 A から何％シェアを奪えるか」  
       をモデル的に比較できる。

---

### 3.4 トライアルモデル・リピートモデル（新製品売上予測モデル）  
- **モデル概要**  
  - 新しい機能や新プランをリリースするときに、  
    1. **トライアル率**：その機能・プランを試してくれるユーザーの割合  
    2. **リピート率**：試した人がそのまま継続してくれる割合  
  - のデータをもとに、「リリース後 1 年間の累積売上／利用者数」を予測する。  
  - モデルには「コンセプトテスト」「βテスト」「世帯パネルデータ」などを使う。

- **BoxLog への応用例**  
  1. **新機能（例：AI タスク分類）リリースの影響予測**  
     - β テスト参加者の「トライアル率 60%」「9 割がリピートしてくれる」という実データをもとに、  
     - 「リリースから 12 か月後には有料ユーザーが +○○ 人増える」といった売上予測ができる。  
  2. **A/B テストの最適化**  
     - 無料プラン／有料プランの境界（例：無料枠でタスク 10 件まで→それ以上は有料）を A/B テストし、  
     - トライアル率／リピート率の違いを比較 →  
     - 「どちらのプラン設定が長期的に LTV を最大化するか」を見極める。

---

### 3.5 平均購入額・量モデル（VPP Model: Volume per Purchase）  
- **モデル概要**  
  - 消費財で「1 回あたり何個買うか」「どのサイズを選ぶか」を予測するモデル。  
  - オンライン SaaS に置き換えると、  
    1. **どのプラン（ライト／スタンダード／プレミアム）を選ぶか**  
    2. **月に追加課金アイテム（例：プレミアムレポート、テンプレートパック）の購入回数**  
  - を最適化するのに使える。

- **BoxLog への応用例**  
  1. **プラン構成の最適化**  
     - 「無料プラン」「月額 500 円プラン（タスク上限あり）」「月額 1,000 円プラン（無制限）」の 3 つを設計している場合、  
     - ユーザー属性（企業 vs. 個人）をもとに **VPP モデル** を当てはめると、  
       - 「どの層が 1,000 円プランを選びやすいか」「どの層が 500 円プランで満足するか」  
       - が数値的に推定できる。  
     - → 価格帯やタスク上限をいくつに定めれば最も収益が良いかを検討できる。  
  2. **追加オプション購入の予測**  
     - 例：「月に 500 円で使えるプレミアムカスタムレポート」を提供するとき、  
     - 「ユーザーが月平均何冊購入するか」をモデル化し、  
     - 「追加収益が月に合計いくらになるか」を推定できる。

---

### 3.6 デリシュレーNBDモデル（Delishwere NBD Model）  
- **モデル概要**  
  - 通常の NBD モデルをさらに拡張し、  
    1. **四半期ごとの利用率・利用回数**  
    2. **100% ロイヤル顧客（最も熱心に使うユーザー）の割合**  
    3. **NBD のカテゴリー K とデリシュレー S（スイッチング確率）の計算方法**  
  - をすべて含めて、「ブランド間のスイッチング動向」「四半期ベースのアクティブ率変動」などを高精度で予測できる。  

- **BoxLog への応用例**  
  1. **四半期ごとのアクティブ率・ヘビーユーザー率の把握**  
     - 過去 4 か月、8 か月、1 年間の「月間 10 回以上ログインしたユーザーの割合」などを算出し、  
     - 「コアなヘビーユーザー（ロイヤル顧客）が何％いるか」  を把握。  
     - → コア層には「専用フォーラム」や「API アクセス権」などの特別機能を提案し、さらに離脱しにくくする。  
  2. **ブランドスイッチング（競合への離脱）予測**  
     - 競合 A・B と BoxLog の間で「四半期ごとに何％が乗り換えるか」を推定し、  
     - 「BoxLog のキャンペーンでプレファレンスを 10 % 上げられたら、四半期後に何人奪えるか」  
       を数式シミュレーションできる。  
     - → 競合動向に応じた広告予算配分やプロモーションタイミングを最適化できる。

---

## 4. NBD モデルの数式と数学的正しさの検証

### 4.1 数式の全体形

提示された NBD モデルの確率質量関数（PMF）は、以下の形で表されます：

\[
P_r \;=\; 
\underbrace{\frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)}}_{\text{(1) 組み合わせ係数}}
\;\times\;
\underbrace{\Bigl(\tfrac{M}{M + K}\Bigr)^{r}}_{\text{(2) 頻度項}}
\;\times\;
\underbrace{\Bigl(\tfrac{K}{M + K}\Bigr)^{K}}_{\text{(3) 形状項}}.
\]

- \(\Gamma(\cdot)\)：ガンマ関数で、整数であれば \(\Gamma(n)=(n-1)!\) に相当。  
- \(\displaystyle \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)}\)：  
  - 整数 \(K\) なら「\(\frac{(K+r-1)!}{(K-1)!\,r!}\)」と同等。  
  - これは **「r 回発生する組み合わせ的なパターンの数」** を表す負の二項係数にあたる。  
- 頻度項 \(\Bigl(\tfrac{M}{M + K}\Bigr)^{r}\)：  
  - \(M\) は「全体として月にどれだけ発生しうるか（平均値の尺度）」を示すパラメーター。  
  - \(r\) が大きいほど分子の \(M\) の影響度合いが強まり、「回数が多い確率を押し上げる」。  
- 形状項 \(\Bigl(\tfrac{K}{M + K}\Bigr)^{K}\)：  
  - \(K\) は「ユーザー間での行動頻度のばらつき」を調整するパラメーター。  
  - \(K\) が大きいほど「分布全体が尖り（ピークが高く狭く）なる」、\(K\) が小さいほど「裾野の広い分布（熱心なユーザーとそうでないユーザーの差が大きい）」になる。  

これらを掛け合わせると、\(\displaystyle \sum_{r=0}^\infty P_r = 1\) を満たす**正規化された確率分布**になります。

---

### 4.2 数式が数学的に正しい（妥当な NBD である）根拠

1. **負の二項分布の定義との一致**  
   - 古典的な「負の二項分布」は、  
     - 「成功確率 \(p\)」、  
     - 「失敗が \(r\) 回起きるまでの試行回数」、  
     - 「失敗回数 \(K\)（形状パラメーター）」  
     のコンテキストで定義されますが、  
   - マーケティング分野では「ガンマ–ポアソン混合分布（Gamma–Poisson mixture）」として、  
     1. 「各ユーザーごとに行動頻度 \(\lambda\) がガンマ分布 \(\text{Gamma}(K, \theta)\) でばらつく」  
     2. 「実際の行動回数はポアソン分布 \(\text{Poisson}(\lambda)\) からサンプリングされる」  
     と仮定するモデルを「NBD モデル」と呼びます。  
   - この混合分布を解析的に積分すると、上記の \(\Gamma\) 関連項＋累乗項の形をとり、正しく負の二項分布（NBD）の PMF が得られます。  

2. **正規化が成立する（\(\sum_{r=0}^\infty P_r = 1\)）**  
   - 次の級数展開により、  
     \[
     \sum_{r=0}^\infty 
     \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)}
     \Bigl(\tfrac{M}{M + K}\Bigr)^r
     \Bigl(\tfrac{K}{M + K}\Bigr)^K
     \;=\;
     \Bigl(\tfrac{K}{M + K}\Bigr)^K
     \sum_{r=0}^\infty 
     \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r+1)}
     \Bigl(\tfrac{M}{M + K}\Bigr)^r
     \]
   - ここで、  
     \[
     \sum_{r=0}^\infty 
     \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r+1)}
     x^r 
     \;=\;
     (1 - x)^{-K}, 
     \quad
     \text{for } |x| < 1.
     \]
   - \(\displaystyle x = \tfrac{M}{M + K} < 1\) とすると、  
     \[
     \sum_{r=0}^\infty P_r 
     \;=\;
     \Bigl(\tfrac{K}{M + K}\Bigr)^K \times 
     \bigl(1 - \tfrac{M}{M + K}\bigr)^{-K}
     \;=\;
     \Bigl(\tfrac{K}{M + K}\Bigr)^K \times \Bigl(\tfrac{K}{M + K}\Bigr)^{-K}
     \;=\; 1.
     \]
   - したがって数学的に**正規化された確率分布**であることが証明される。  

3. **ガンマ関数の利用**  
   - \(\Gamma(K + r)\)、\(\Gamma(K)\)、\(\Gamma(r + 1)\) の組み合わせは、  
     - 整数 \(K\)、\(r\) の場合は階乗に対応（\(\Gamma(n)=(n-1)!\)）。  
     - \(K\) を連続値として扱える（形状パラメーターとして滑らかに扱える）利点がある。  
   - つまり、「\(K\) を整数に限定しないまま、ユーザー間の行動ばらつきを柔軟にモデリングできる」という点で有用。  

4. **実装ライブラリの存在**  
   - Python の `scipy.stats.nbinom`、R の `MASS::glm.nb`、その他多くの統計ライブラリが同等の形を実装しており、  
   - 「定義通りこの関数を使ったとき、\(\hat K,\hat M\) を与えれば確率分布が返り、データフィットの検証ができる」ことが実証されている。  

---

## 5. NBD モデルを BoxLog にあてはめる具体的ステップ例

以下に、BoxLog の実データを用いて NBD モデルを実際にあてはめ、活用するフローを示します。

1. **データ収集**  
   - BoxLog のユーザーデータベースから、過去 3～6 ヵ月分の以下を抽出する：  
     1. ユーザー ID  
     2. 各月ごとのログイン回数（またはタスク操作回数）  
     3. プランタイプ（無料／有料プランなど）  
     4. 最終ログイン日（Recency 用）  
     5. 追加課金アイテムの購入履歴（Volume per Purchase 用）  

2. **前処理・集計**  
   - 「ユーザーごとに月 \(t\) のログイン回数 \(r_{i,t}\)」を表形式に整形する。  
   - 欠損値（例：退会済みユーザー）は \(r=0\) とみなしてもよいが、退会時期を記録していれば除外も検討する。  
   - 安定した統計量を得るために、「少なくとも 3 か月以上稼働しているユーザー」などでフィルターをかける。  

3. **NBD モデルへのフィット（パラメータ推定）**  
   - Python 例：  
     ```python
     # 例: Python で 'lifetimes' ライブラリを使う場合
     from lifetimes import BetaGeoFitter
     import pandas as pd

     # data: DataFrame に 'frequency' (過去の取引回数), 'recency' (最終取引からの経過時間), 'T' (観測期間) がある
     bgf = BetaGeoFitter(penalizer_coef=0.0)
     bgf.fit(data['frequency'], data['recency'], data['T'])

     # NBD の場合、BetaGeoFitter が Gamma–Poisson モデルを扱うが、同様の手順で推定が可能
     ```
   - もしくは、Scipy を使って最尤推定（MLE）を自前で実装する場合、  
     1. 負の二項分布の対数尤度関数を定義  
     2. \(\hat K, \hat M\) を最適化ライブラリ（scipy.optimize）で推定  

4. **フィットの検証**  
   - 推定された \(\hat K, \hat M\) をもとに、  
     \[
     \hat P_r = \frac{\Gamma(\hat K + r)}{\Gamma(\hat K)\,\Gamma(r + 1)} \Bigl(\tfrac{\hat M}{\hat M + \hat K}\Bigr)^r \Bigl(\tfrac{\hat K}{\hat M + \hat K}\Bigr)^{\hat K}
     \]
   - として「理論確率分布」（r=0,1,2,…）を算出。  
   - 実際の「全ユーザーにおける月別ログイン回数分布」と棒グラフで比較（例：r を横軸、割合を縦軸）し、モデルが実データに近いかを確認。  
   - もし著しくずれていれば、  
     - 前処理時のサンプリングバイアス  
     - 観測期間の設定ミス  
     - 「一部のユーザーが異常に多く利用している」などの外れ値  
     といった要因を再確認する。

5. **応用例：特定回数群の抽出と施策**  
   - **r=0（休眠）のユーザー**  
     - \(\hat P_{r=0}\) が比較的大きい場合、「休眠リスクが高いユーザーが多い」ことを示唆。  
     - 休眠ユーザー限定のキャンペーンやプッシュ通知の配信を設計。  
   - **r ≥ 10（ヘビーユーザー）の割合**  
     - \(\sum_{r=10}^{\infty} \hat P_r\) は「月に 10 回以上ログインするユーザーの割合」。  
     - その割合 x 有料転換率仮説  ＝「月次有料会員数増加予測」に使う。  
   - **r の連続値を使ったビジュアル分析**  
     - 実際のレポートとして、  
       ```plaintext
       r   | 実データの割合 | 理論分布（NBD）の割合
       ----+---------------+----------------------
       0   | 14.3%         | 13.8%
       1   | 18.7%         | 19.1%
       2   | 17.5%         | 17.8%
       ... | ...           | ...
       10  |  5.2%         |  5.5%
       20  |  1.1%         |  1.0%
       ```
     - このようにテーブルやグラフで一覧化し、「フィット感」を一目で把握できる。

6. **ブランドスイッチング（乗り換え）を含めた拡張**  
   - BoxLog ⇄ 競合 A, B の間で「月ごとの乗り換え確率」を外部データから推定し、  
     - NBD モデルに「デリシュレー S」パラメーターを追加すると、  
     - 「3 か月後に BoxLog から競合 A に乗り換えるユーザーは x％」「競合 A から BoxLog に乗り換えるのは y％」といった双方向シミュレーションが可能。  
   - ここまで踏み込むと、  
     - 「マーケティング投資をどこに振れば、いちばん競合からのシェア奪取効率が良いか」  
     - 「ボトルネックは UI なのか、機能なのか、それとも認知度なのか」  
     - といった高度なシナリオ検証が数式ベースでできるようになる。  

---

## 6. 数式の導出イメージ（復習用）

1. **ポアソン分布 \(\text{Pois}(\lambda)\)**  
   - 「単一ユーザーが、ある一定期間に \(\lambda\) の平均で行動（ログイン）を起こす」場合、  
     \[
     P(\text{ログイン回数} = r \mid \lambda) 
     \;=\; 
     \frac{\lambda^r\,e^{-\lambda}}{r!}.
     \]
   - しかし個々のユーザーでは「行動頻度 \(\lambda\) にばらつきがある」ため、そのばらつきをガンマ分布でモデリングする。

2. **ガンマ分布（Gamma）を形状パラメーター \(K\)、尺度パラメーター \(\theta\) で表す**  
   - ガンマ分布で「ユーザーごとの行動頻度 \(\lambda\) が \(\text{Gamma}(K, \theta)\) に従う」と仮定すると、  
     - 期待値：\(E[\lambda] = K \theta\)  
     - 分散：\(\mathrm{Var}[\lambda] = K \theta^2\)  
     - \(\theta\) をうまく再パラメータ化し、\(\theta = \tfrac{M}{K}\)（あるいはその逆）として、  
       - \(M\)：全体の「平均行動回数」のスケール（たとえば「月間ログイン数総計 ÷ ユーザー数」）  
       - \(K\)：行動頻度のばらつきをコントロールする形状パラメータ  
   - と対応させると、ガンマ分布の確率密度関数は  
     \[
     f(\lambda) 
     = \frac{\lambda^{K - 1} e^{-\lambda / \theta}}{\Gamma(K)\,\theta^K} 
     = 
     \frac{\lambda^{K - 1}}{\Gamma(K)} 
     \Bigl(\tfrac{K}{M}\Bigr)^K 
     e^{ - \lambda \cdot \tfrac{K}{M} }.
     \]

3. **ポアソン × ガンマ混合 → 負の二項分布**  
   - 「各ユーザーごとに \(\lambda \sim \text{Gamma}(K, M/K)\)」  
   - 「そのユーザーの行動回数 \(r \mid \lambda \sim \text{Pois}(\lambda)\)」  
   - とすると、周辺化（積分）して  
     \[
     P(r) 
     = \int_0^\infty P(r \mid \lambda)\,f(\lambda)\,d\lambda 
     = \int_0^\infty 
       \frac{\lambda^r e^{-\lambda}}{r!} \times 
       \frac{\lambda^{K - 1}}{\Gamma(K)} 
       \Bigl(\tfrac{K}{M}\Bigr)^K 
       e^{ - \lambda \cdot \tfrac{K}{M} }\,d\lambda.
     \]
   - この積分を評価すると、最終的に  
     \[
     P_r
     = \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)} 
       \Bigl(\tfrac{M}{M + K}\Bigr)^r 
       \Bigl(\tfrac{K}{M + K}\Bigr)^K
     \]
   - という形になる。これが**負の二項分布（NBD）モデルの確率質量関数**であり、「\(\sum_{r=0}^\infty P_r = 1\)」が成り立つ。

---

## 7. BoxLog における NBD モデルの活用サンプル・ケーススタディ

以下に、BoxLog を展開していく上で「実際にどのように NBD モデルを使って課題を解決するか」「どのようなインサイトが得られるか」を具体的に示します。

### ケース 1：月間アクティブユーザー（MAU）とヘビーユーザー率の把握

1. **目的**  
   - 「BoxLog を使い続けてくれるコアユーザーがどれくらいいるか」  
   - 「改善施策を施すべきユーザーセグメントはどこか」  

2. **ステップ**  
   1. 過去 6 か月間の「ユーザー別月間ログイン回数」をリスト化。  
   2. NBD モデルにフィット → \(\hat K, \hat M\) を推定。  
   3. 理論分布 \(\{P_r\}\) を算出し、実データ分布と比較。  
   4. \(\sum_{r \ge 10} P_r\)：月 10 回以上ログインする確率 → 「ヘビーユーザー率」を定量化。  
   5. \(\sum_{r = 0} P_r\)：月 0 回（休眠）確率 → 「離脱リスクユーザー率」を把握。  

3. **期待される成果**  
   - 「実際にヘビーユーザー率が 8％、休眠率が 15％と判明」  
   - → ヘビーユーザー向けには「エキスパート向けチュートリアル」「プレミアム機能の Early Access」を提供し、さらなるロイヤル化を図る。  
   - → 休眠ユーザー向けには「リマインドメール」「ライトな使い方 Tips」「限定クーポン」を送付し、再利用を促す。  

---

### ケース 2：有料プラン転換シミュレーション

1. **目的**  
   - 「BoxLog の無料ユーザーが、有料プランに乗り換える確率を事前に予測し、売上を試算する」  

2. **ステップ**  
   1. **仮説設定**  
      - 「月 5 回以上ログインするユーザーの×％が有料プランに乗り換えやすい」  
      - 例えば「月 5 回以上ログインするユーザーの 25％ が有料プランに移行する」  
   2. **モデルフィット**  
      - NBD モデルで \(\{P_r\}\) を算出 → \(\sum_{r \ge 5} P_r\) を計算する。  
      - 例：\(\hat K=1.2, \hat M=4.5\) の場合、\(\sum_{r \ge 5} P_r \approx 0.35\)（月 5 回以上ログインする確率が 35％）。  
   3. **売上シミュレーション**  
      - 月間ユーザー数 100,000 人とすると、  
        - 月 5 回以上ログインする人：100,000 × 0.35 = 35,000 人  
        - うち 25％ が有料プランに：「35,000 × 0.25 = 8,750 人」 が月額料金を支払う見込み  
      - 月額料金を 500 円とすれば、月間売上予測：8,750 × 500 = ¥4,375,000  

3. **期待される成果**  
   - 「今のプラン設計だと、有料会員を最大限引っ張ってこれるのは 8,750 人前後」  
   - → もし「月額 500 円プラン → 650 円プラン」に値上げを検討する場合、  
     - 有料転換率が例えば 20% に下がると仮定すると、  
     - 売上：\(35,000 × 0.20 × 650 = ¥4,550,000\)  
   - これにより「値上げ vs. 転換率低下」のトレードオフを事前に評価できる。

---

### ケース 3：休眠リスクユーザーへの施策優先度付け

1. **目的**  
   - 「次のプロダクトアップデートまでにどの休眠ユーザーに注力して復帰を促すべきか」  

2. **ステップ**  
   1. NBD モデルで「月間ログイン回数」の確率分布を算出 → \(\hat P_{r=0}\) を得る（各ユーザーの個別 \(\lambda_i\) まで推定できれば「再利用確率」をより精緻に出せる）。  
   2. ガンマ・ポアソン・リーセンシーモデルで「最終ログインからの経過日数×利用頻度」を入力して「来週に再利用しない確率」を計算。  
   3. 「再利用しない確率が 90% 以上のユーザー」、もしくは「再利用しない確率が 70〜90% の特に有料プラン経験者」を優先ターゲットに設定。  
   4. 該当ユーザーに対し「限定機能紹介メール」「特別クーポン付きプッシュ通知」などを配信するスケジュールを組む。  

3. **期待される成果**  
   - 「休眠リスクの高いユーザー 2,000 人に対して施策を打ち、リテンション率を +10% 改善 → 月間 MAU が +200 人増」などの定量的インパクトを把握。  

---

## 8. Markdown ドキュメントサンプル：すべての情報をまとめる

以下に、ここまでの情報をそのまま Markdown ドキュメントに落とし込んだサンプルを提示します。実際に README や社内ドキュメントにコピー＆ペーストしてご活用ください。

---

```markdown
# BoxLog における顧客行動モデルと数学ツールの活用ガイド

## 目次

1. [はじめに：プレファレンスと売上モデルの全体像](#はじめにプレファレンスと売上モデルの全体像)  
2. [BoxLog におけるモデルの置き換え](#boxlog-におけるモデルの置き換え)  
   1. [BoxLog の文脈で「プレファレンス」を考える](#boxlog-の文脈でプレファレンスを考える)  
   2. [BoxLog における「M と K」の置き換え](#boxlog-におけるm-と-kの置き換え)  
   3. [BoxLog における「ポアソン分布」「NBD モデル」のイメージ](#boxlog-におけるポアソン分布nbd-モデルのイメージ)  
3. [6 つの数学ツール（モデル）と BoxLog での活用イメージ](#6-つの数学ツールモデルと-boxlog-での活用イメージ)  
   1. [ガンマ・ポアソン・リーセンシー・モデル](#1-ガンマポアソンリーセンシーモデル)  
   2. [負の二項分布（NBD Model）](#2-負の二項分布nbd-modelnegative-binomial-distribution)  
   3. [カテゴリーの進出順位モデル（Order of Entry Model）](#3-カテゴリーの進出順位モデルorder-of-entry-model)  
   4. [トライアルモデル・リピートモデル（新製品売上予測モデル）](#4-トライアルモデルリピートモデル新製品売上予測モデル)  
   5. [平均購入額・量モデル（VPP Model: Volume per Purchase）](#5-平均購入額量モデルvpp-model-volume-per-purchase)  
   6. [デリシュレーNBDモデル（Delishwere NBD Model）](#6-デリシュレーnbdモデルdelishwere-nbd-model)  
4. [NBD モデルの数式と数学的正しさの検証](#nbd-モデルの数式と数学的正しさの検証)  
   1. [数式の全体形](#数式の全体形)  
   2. [数式が数学的に正しい根拠](#数式が数学的に正しい根拠)  
5. [NBD モデルを BoxLog にあてはめる具体的ステップ例](#nbd-モデルを-boxlog-にあてはめる具体的ステップ例)  
6. [BoxLog における NBD モデルの活用サンプル・ケーススタディ](#boxlog-における-nbd-モデルの活用サンプルケーススタディ)  
   1. [ケース 1：月間アクティブユーザーとヘビーユーザー率の把握](#ケース-1月間アクティブユーザーとヘビーユーザー率の把握)  
   2. [ケース 2：有料プラン転換シミュレーション](#ケース-2有料プラン転換シミュレーション)  
   3. [ケース 3：休眠リスクユーザーへの施策優先度付け](#ケース-3休眠リスクユーザーへの施策優先度付け)  

---

## はじめに：プレファレンスと売上モデルの全体像

1. **プレファレンス（好み／好き度）とは？**  
   - 個々のユーザーが頭の中で「どのブランドをどれだけ使ってみたいか」と考える度合いをプレファレンスと呼ぶ。  
   - 例：ジュースなら「A 社のオレンジジュースが好き」「B 社のぶどうジュースが好き」といったイメージ。  
   - プレファレンスが高いほど、そのブランドの購入シェアが大きくなり、最終的に売上（シェア）を決定づける。  
   - 理想的に認知度 100%、配荷率 100%、十分な時間があれば、プレファレンスがそのままユニットシェアとして現れる。  

2. **モデル化の流れ**  
   1. **二項分布（Binomial Distribution）**  
      - 「コインを 10 回投げて表が何回出るか」など、回数が固定された試行の中で「成功／失敗」が何回起こるかを確率で考える。  
      - ジュース購買に置き換えると、「10 人のうち何人がジュースを買うか」を確率的に推定できる。  
   2. **ポアソン分布（Poisson Distribution）**  
      - 「ある時間の中・ある母集団の中で、平均どれくらい起こるか」がわかっていれば、「実際に何回起こるか」を確率で扱うモデル。  
      - ジュースの話では「1 時間に 3 人くらい自販機に来る」と仮定し、その「何人来るか」を予測する。  
   3. **負の二項分布（NBD Model: Negative Binomial Distribution）**  
      - ポアソン分布の考えを拡張しつつ、  
        - **M（市場規模）**：購入検討する人の数  
        - **K（行動頻度の平均・ばらつき）**：1 人あたり平均何回買うか、およびユーザー間のばらつき  
        - **プレファレンス（ブランド選択比率）**  
        - **スイッチング（ブランド乗り換え）確率**  
      - を組み合わせることで、「あるユーザーが月に何回購入するか」「どのブランドを選ぶか」まで高精度で予測できるモデル。  
   4. **数式全体と解釈**  
      - NBD の確率質量関数（PMF）として、  
        \[
        P_r \;=\; 
        \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)} 
        \;\times\; 
        \Bigl(\frac{M}{M + K}\Bigr)^r 
        \;\times\; 
        \Bigl(\frac{K}{M + K}\Bigr)^K
        \]
      - \(\sum_{r=0}^\infty P_r = 1\) を満たす正規化された確率分布である。  
   5. **結論**  
      - これらのステップを踏むことで、「プレファレンスがブランド売上を支配する」という直感を数式で裏付けられる。  
      - いきなり NBD の難しい数式に触れるのではなく、二項分布 → ポアソン分布 → NBD と段階的に理解を深める。

---

## BoxLog におけるモデルの置き換え

### BoxLog の文脈で「プレファレンス」を考える

- タスク管理アプリ市場で、ユーザーは複数の選択肢（BoxLog、競合 A、競合 B…）の中から「どれを使おうか？」と判断する。  
- **プレファレンス** は、  
  1. UI/UX（見た目・操作性）  
  2. 機能（タイムボクシング、ログ記録、タグ機能など）  
  3. 口コミ／評判  
  4. 価格／プラン体系  
  5. 広告やプロモーション  
  などが総合された「そのブランドを使ってみたい度合い」を示す。  
- 例：タスク管理アプリを試そうと思っている 100,000 人のうち、50% が BoxLog を選ぶなら、  
BoxLog のプレファレンス = 0.50（50%）
競合 A のプレファレンス = 0.30（30%）
競合 B のプレファレンス = 0.20（20%）

markdown
コピーする
編集する

---

### BoxLog における「M と K」の置き換え

| 数学モデル上のパラメーター | ジュースモデルのイメージ              | BoxLog への置き換え                                        |
|----------------------------|---------------------------------------|-----------------------------------------------------------|
| **M（市場規模／Scale）**     | その地域で「ジュースを買いにくる人の数」 | 「毎月タスク管理アプリを使おうと考える潜在ユーザー数（例：100,000 人）」 |
| **K（形状パラメーター）**    | 1 人あたり平均「月に何本買うか」、ばらつき | 1 人あたり平均「月に何回ログイン／タスク操作するか」、ばらつき  |
| **プレファレンス**           | 各ブランドを選ぶ確率比（例：A=60％、B=30％など） | 各タスク管理アプリ（BoxLog、競合 A、競合 B）を選ぶ確率比         |
| **r（発生回数）**            | ある人が「今月ジュースを r 回買う」       | あるユーザーが「今月 BoxLog に r 回ログイン／タスク操作する」   |
| **デリシュレーS（スイッチング）** | 一定期間後に他ブランドへ乗り換える確率     | 一定期間後に他アプリへ乗り換える確率                             |

- **M の具体例**  
- 検索ボリューム、業界レポート、ウェブサイトトラフィックなどから、「毎月 100,000 人がタスク管理アプリを探す」  
- **K の具体例**  
- ユーザーログから、「月に平均 8 回ログインする人が多い」「0 回〜100 回までばらつきがある」を数値化する  
- **プレファレンスの具体例**  
- Web アクセスログやアンケートを使って、「この 100,000 人のうち 50% が BoxLog を使ってみたい」と推定する  
- **r の具体例**  
- 各ユーザーごとに「今月のログイン回数」が 0 回、1 回、2 回…と記録されているデータ  

---

### BoxLog における「ポアソン分布」「NBD モデル」のイメージ

1. **ポアソン分布（簡易イメージ）**  
 - BoxLog 全体で「月間ログイン回数の合計」が 500,000 回だと仮定する。  
 - 平均 λ ＝（500,000 ÷ 月間アクティブユーザー数） を設定し、  
   - 「月に 0 回ログインする確率」「月に 1 回」「月に 2 回…」を計算。  
 - ただし、個々のユーザーのばらつき（熱心なヘビーユーザー vs. 休眠しがちなユーザー）は反映されない。

2. **負の二項分布（NBD モデル）のイメージ**  
 - 「母集団としてログイン行動を起こす人（M）」「各人の平均ログイン回数・ばらつき（K）」「BoxLog を選ぶ確率（プレファレンス）」を組み合わせ、  
   - **ユーザーごとに『今月 r 回ログインする確率 \(P_r\) （r = 0,1,2,…）』**  
   - を予測するモデル。  
 - **ステップ**  
   1. ユーザー全体の「月間ログイン回数分布」を取得する → \(\hat K, \hat M\) を最尤推定  
   2. プレファレンスを「市場調査」や「検索データ」で推定 → モデルに組み込む  
   3. \(\{P_r\}\) を計算し、「\(\sum_{r=0} P_r\) = 1」を確認  
 - **応用**  
   - 「休眠ユーザー（r=0）の割合」を復帰施策に使う  
   - 「月に 10 回以上ログインするユーザーの割合」を有料プラン転換率にかけて売上シミュレーション  
   - 「来月・半年後の MAU」をシミュレーション → UI 改善やキャンペーン効果の事前評価  

---

## 6 つの数学ツール（モデル）と BoxLog での活用イメージ

### 1. ガンマ・ポアソン・リーセンシー・モデル (Gamma–Poisson Recency Model)

- **モデル概要**  
- ユーザーごとの「最終ログイン日（Recency）」「累計ログイン回数（Frequency）」をもとに、  
  - 「再度ログインしてくれる確率」  
  - 「LTV（顧客生涯価値）の推定」  
- を行う。  
- ガンマ分布で「ユーザー行動頻度のばらつき」を表現し、ポアソン分布で「一定期間内に再利用する確率」を推定する。

- **BoxLog への応用例**  
1. **休眠リスク予測（離脱予兆）**  
   - ユーザーごとに「最終ログインからの経過日数」「過去 3 か月のログイン回数」を入力し、  
     \[
     \text{再利用確率} =
     \int_0^\infty \underbrace{\text{Poisson}(r \mid \lambda)}_{\text{行動回数}} \times \underbrace{\text{Gamma}(\lambda \mid K,\,\tfrac{M}{K})}_{\text{頻度のばらつき}}\,d\lambda
     \]
   - により、「来週中に再ログインしない確率」を推定。  
   - → 休眠リスクが高いユーザーに絞ってリマインドメールやプッシュ通知を送る。  
2. **LTV（顧客生涯価値）のざっくり推計**  
   - 「過去の行動頻度から今後の行動回数を予測」  
   - 「無料→有料転換率や単価を掛け合わせる」  
   - で、広告投資の回収可能性（CAC vs. LTV）をざっくり判断。  

---

### 2. 負の二項分布（NBD Model: Negative Binomial Distribution）

- **モデル概要**  
- 「ユーザーの月間ログイン回数分布」を、  
  1. **M（市場規模）**：タスク管理アプリを使おうとする潜在ユーザー数  
  2. **K（行動頻度の平均・ばらつき）**：1 人あたり平均何回ログインするか、ユーザー間のばらつき  
  3. **プレファレンス**：BoxLog を選ぶ確率比（競合との相対比）  
  - を用いて推定する。  
- さらに「スイッチング確率（他アプリへの乗り換え）」を組み込むと、競合動向まで含めたシミュレーションが可能。

- **数式（確率質量関数）**  
\[
P_r \;=\; 
\underbrace{\frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r+1)}}_{\text{負の二項係数}}
\;\times\;
\underbrace{\Bigl(\tfrac{M}{M + K}\Bigr)^{r}}_{\text{頻度項}}
\;\times\;
\underbrace{\Bigl(\tfrac{K}{M + K}\Bigr)^{K}}_{\text{形状項}},
\quad r = 0, 1, 2, \dots
\]
- \(\displaystyle \sum_{r=0}^\infty P_r = 1\) が成り立つ数学的に正しい分布である。

- **BoxLog への応用例**  
1. **実ユーザーデータへのフィット**  
   - 「ユーザーごとの過去ログイン回数」を集計し、\(\{r_i\}\) の頻度分布を作成。  
   - 最尤推定やライブラリを使って \(\hat K, \hat M\) を推定 → 理論分布 \(\{P_r(\hat K,\hat M)\}\) を算出。  
   - 実データ分布と比較してフィット感を確認する。  
2. **プラン設計・課金率ベンチマーク**  
   - 例：「月 10 回以上ログインする人の 30％ が有料転換する」という仮説を置くと、  
     \[
     \text{有料転換候補率} \;=\; \sum_{r=10}^{\infty} P_r(\hat K, \hat M)
     \]
     を求め、その値に 0.30 を掛ければ「有料転換率の予測値」が得られる。  
3. **スイッチング（競合への乗り換え）**  
   - NBD モデルに「デリシュレー S（スイッチング動向）」を導入すると、  
     - BoxLog ⇄ 競合 A などの双方向シミュレーションが可能  
     - 「4 か月後に BoxLog ユーザーの 15％ が競合に移る」という予測などを行える。  

---

### 3. カテゴリーの進出順位モデル（Order of Entry Model）

- **モデル概要**  
- 新カテゴリ（例：「タスク管理×タイムボクシング」）で、  
  - 「BoxLog が 3 番目に参入したらシェアはどれくらいか？」  
  - 「参入タイミング／マーケティング投資量を変えるとシェア獲得にどう影響するか？」  
- をシミュレーションできるモデル。

- **BoxLog への応用例**  
1. **競合リリースシミュレーション**  
   - 市場全体の成長率、先発競合 A・B のユーザー数・ブランド力、BoxLog のマーケ予算を入力。  
   - 「3 年後に BoxLog が市場で取れるシェア」を推定できる。  
2. **機能追加タイミングの検討**  
   - 先発企業が持っていない「AI タスク分類機能」を BoxLog が開発するタイミングをずらし、  
   - 「認知獲得率」「競合から奪えるシェア」を定量的に比較できる。  

---

### 4. トライアルモデル・リピートモデル（新製品売上予測モデル）

- **モデル概要**  
- 新機能や新プランを出すときに、  
  1. **トライアル率**：β テスト／概念テストで「実際に試してくれる人の割合」  
  2. **リピート率**：試したユーザーが「継続して利用する割合」  
- のデータをもとに、「リリース 1 年目の売上／利用ユーザー数」を予測するモデル。

- **BoxLog への応用例**  
1. **新機能（例：AI タスク予測機能）リリース**  
   - β テスト参加者の「60％ が本番リリース後も継続利用」「40％ が有料プランに移行」などの実績を取得。  
   - その数値をモデルに入れ、「リリース後 12 か月で有料ユーザーが何人増えるか」をシミュレーション。  
2. **A/B テストの最適化**  
   - 無料→有料プランの境界条件をテスト → トライアル率／リピート率を比較  
   - 「どのプラン設定なら長期的に LTV を最大化できるか」を判断する。

---

### 5. 平均購入額・量モデル（VPP Model: Volume per Purchase）

- **モデル概要**  
- 消費財で「1 回あたり何個買うか」「どのサイズを選ぶか」を扱うモデル。  
- SaaS に置き換えると、  
  1. **プラン選択（ライト／スタンダード／プレミアム）**  
  2. **追加課金アイテム（例：プレミアムレポート）の購入回数**  
- などを最適化する。

- **BoxLog への応用例**  
1. **プラン構成最適化**  
   - 「無料プラン」「月額 500 円プラン（タスク上限 50 件）」「月額 1,000 円プラン（無制限）」を用意。  
   - ユーザー属性（企業 vs. 個人）を入力し、VPP モデルで「どの層がどのプランを選びやすいか」を予測。  
   - → プラン価格・上限数のチューニングに使う。  
2. **追加オプション購入予測**  
   - 「月額 500 円で使えるプレミアムカスタムレポート」を設置。  
   - 追加アイテムの過去購入履歴をもとに、VPP モデルで「月平均何冊購入するか」を推定。  
   - → 月間追加収益を試算する。

---

### 6. デリシュレーNBDモデル（Delishwere NBD Model）

- **モデル概要**  
- 通常の NBD モデルを拡張し、  
  1. **四半期ごとの利用率・利用回数**  
  2. **100％ロイヤル顧客（最も熱心なヘビーユーザー）の割合**  
  3. **NBD のカテゴリー K とデリシュレー S（ブランド間スイッチング）**  
- を網羅したモデル。ブランド間の乗り換え動向や四半期ベースのアクティブ推移を高精度で予測できる。

- **BoxLog への応用例**  
1. **四半期ごとのアクティブ率・ヘビーユーザー率**  
   - 「四半期ベースで月間 10 回以上ログインするユーザーが何％いるか」「全くログインしないユーザーが何％か」をモデルで算出。  
   - → ヘビーユーザーにはカスタムサポートを提供、休眠層には復帰施策を打つなどターゲティングが可能。  
2. **ブランドスイッチング（競合への離脱）予測**  
   - 競合 A・B と BoxLog の間で「四半期ごとに何％が乗り換えるか」を推定 → モデル化。  
   - → 「広告投下量を 10％増やしたら、四半期後に競合から x 人奪える」などをシミュレーションできる。

---

## NBD モデルの数式と数学的正しさの検証

### 数式の全体形

\[
P_r \;=\; 
\underbrace{\frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)}}_{\text{(1) 負の二項係数}}
\;\times\;
\underbrace{\Bigl(\tfrac{M}{M + K}\Bigr)^{r}}_{\text{(2) 頻度項}}
\;\times\;
\underbrace{\Bigl(\tfrac{K}{M + K}\Bigr)^{K}}_{\text{(3) 形状項}}, 
\quad r = 0, 1, 2, \dots
\]

- **(1) 負の二項係数**  
- \(\displaystyle \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)}\)  
- 整数 \(K\) の場合、\(\Gamma(K)=(K-1)!\)、\(\Gamma(K+r)=(K+r-1)!\) となり、  
  \[
  \frac{(K + r - 1)!}{(K - 1)!\,r!}
  \]
  と同等である。  
- これが「\(\;r\) 回発生する組み合わせ的なパターンの数」を表す。  

- **(2) 頻度項** \(\Bigl(\tfrac{M}{M + K}\Bigr)^{r}\)  
- \(M\)（平均行動回数を尺度化したパラメーター）が大きいほど、「高い \(r\) に寄与しやすい」。  
- \(r\) が増えるほど強く影響し、「多くログインする確率が高くなる」効果。  

- **(3) 形状項** \(\Bigl(\tfrac{K}{M + K}\Bigr)^{K}\)  
- \(K\) が大きいほど、この項は 1 に近づき、「分布全体のばらつきが小さくなる」。  
- \(K\) が小さいほど、この項が小さくなり、「裾野の広い分布（熱心なヘビーユーザーとそうでないユーザーの差が大きい）」に近づく。  

- **正規化の検証**  
- \(\displaystyle \sum_{r=0}^\infty P_r = 1\) となることを級数展開で示せる。  
- 具体的には、  
  \[
  \sum_{r=0}^\infty 
  \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r+1)} 
  \Bigl(\tfrac{M}{M + K}\Bigr)^r 
  \Bigl(\tfrac{K}{M + K}\Bigr)^K 
  \;=\;
  \Bigl(\tfrac{K}{M + K}\Bigr)^K 
  \sum_{r=0}^\infty \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r+1)} 
  \Bigl(\tfrac{M}{M + K}\Bigr)^r. 
  \]
- ここで、\(\sum_{r=0}^\infty \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r+1)} x^r = (1 - x)^{-K} \; (|x|<1)\) を使うと、  
  \[
  \Bigl(\tfrac{K}{M + K}\Bigr)^K 
  \cdot 
  \Bigl(1 - \tfrac{M}{M + K}\Bigr)^{-K} 
  = 
  \Bigl(\tfrac{K}{M + K}\Bigr)^K 
  \cdot 
  \Bigl(\tfrac{K}{M + K}\Bigr)^{-K} 
  = 1. 
  \]
- よって、この分布は数学的に**正規化された確率分布**である。

---

## NBD モデルを BoxLog にあてはめる具体的ステップ例

1. **データ収集**  
 - BoxLog のユーザー DB から、過去 3～6 か月分の「ユーザーごとの月間ログイン回数」「プラン種別」「最終ログイン日」「追加課金アイテム購入履歴」などを抽出する。  
 - 可能であれば「競合アプリの公開値」「業界レポートでの市場規模」「アンケート結果でのプレファレンス比」なども併せて収集しておく。

2. **前処理・集計**  
 - 「ユーザー ID」「観測月」「月間ログイン回数 \(r_{i,t}\)」というテーブル形式にまとめる。  
 - 必要であれば「少なくとも 3 か月以上稼働したユーザー」のみ抽出し、サンプルバイアスを抑える。  
 - 退会済みユーザーは「\(r=0\)」とみなすか、除外するかを方針化しておく（例：退会日以前のみカウント）。

3. **NBD モデルへのフィット（パラメータ推定）**  
 - Python の `lifetimes` ライブラリや `scipy.optimize` を使って、\(\hat K\) および \(\hat M\) を最尤推定で求める。  
 - 例（Python with `lifetimes` ライブラリ）：  
   ```python
   from lifetimes import BetaGeoFitter
   import pandas as pd

   # data: DataFrame に 'frequency', 'recency', 'T' カラムがあると仮定
   bgf = BetaGeoFitter(penalizer_coef=0.0)
   bgf.fit(data['frequency'], data['recency'], data['T'])
   # bgf が学習したパラメータが内部的に NBD モデルに対応
   ```
 - あるいは `scipy` で手動実装：  
   ```python
   import numpy as np
   from scipy.special import gamma, gammaln
   from scipy.optimize import minimize

   # 例: ユーザーごとのログイン回数リスト r_list があるとする
   def negative_binomial_log_likelihood(params, r_list):
       K, M = params
       if K <= 0 or M <= 0:
           return np.inf
       ll = 0
       for r in r_list:
           ll += (
               gammaln(K + r) - gammaln(K) - gammaln(r + 1)
               + r * np.log(M / (M + K))
               + K * np.log(K / (M + K))
           )
       return -ll  # 最尤推定では対数尤度の負を最小化

   initial_guess = np.array([1.0, np.mean(r_list)])
   result = minimize(
       negative_binomial_log_likelihood,
       initial_guess,
       args=(r_list,),
       method='L-BFGS-B',
       bounds=((1e-6, None), (1e-6, None))
   )
   hat_K, hat_M = result.x
   ```
 - **出力**: \(\hat K, \hat M\)（それぞれ行動頻度のばらつき、平均尺度）

4. **フィットの検証**  
 - 得られた \(\hat K, \hat M\) を使い、理論分布 \(\hat P_r\) を算出：  
   \[
   \hat P_r 
   = 
   \frac{\Gamma(\hat K + r)}{\Gamma(\hat K)\,\Gamma(r+1)} 
   \Bigl(\tfrac{\hat M}{\hat M + \hat K}\Bigr)^r 
   \Bigl(\tfrac{\hat K}{\hat M + \hat K}\Bigr)^{\hat K}.
   \]
 - 実データで「r 回ログインするユーザーの割合」と理論分布をプロットして比較（棒グラフなど）。  
 - 両者が近ければ「NBD モデルで BoxLog のログイン行動を十分説明できている」とみなせる。

5. **応用例**  
 1. **休眠リスクユーザーの抽出**  
    - \(\hat P_{r=0}\)（月 0 回ログインする確率）が高いユーザーを絞り込む。  
    - リマインドメールやプッシュ通知を送る優先度として活用。  
 2. **ヘビーユーザー率の把握**  
    - \(\sum_{r \ge 10} \hat P_r\)：月 10 回以上ログインする確率  
    - 実データ比と比較し、ヘビーユーザーの割合を把握 → エンゲージメント向上策を検討。  
 3. **有料プラン転換シミュレーション**  
    - \(\sum_{r \ge 5} \hat P_r\) を使い、「5 回以上ログインする割合」を計算 → 仮説転換率を掛け合わせて売上予測。  
 4. **ブランドスイッチング**  
    - 「競合 A、B から BoxLog へ乗り換える確率」「BoxLog から競合へ乗り換える確率」をデリシュレー S でモデリングし、  
    - 「キャンペーンによるプレファレンス変化が 10％ だった場合、何人の乗り換えユーザーを獲得できるか」などを予測。  

---

## BoxLog における NBD モデルの活用サンプル・ケーススタディ

### ケース 1：月間アクティブユーザー（MAU）とヘビーユーザー率の把握

1. **目的**  
 - BoxLog を継続利用しているコアユーザーの割合や、休眠リスクユーザーの割合を把握する。  

2. **フロー**  
 1. 過去 6 か月間の「ユーザーごとの月間ログイン回数（r）」を収集。  
 2. NBD モデルにフィットして \(\hat K, \hat M\) を推定。  
 3. 理論分布 \(\hat P_r\) を求める。  
 4. \(\sum_{r=10}^\infty \hat P_r\)：月 10 回以上ログインする確率 → ヘビーユーザー率。  
 5. \(\hat P_{r=0}\)：月 0 回ログインする確率 → 休眠リスクユーザー率。  

3. **仮想結果**  
 - \(\hat K = 1.2\)、\(\hat M = 4.5\) にフィットした場合、  
   - \(\sum_{r=10}^\infty \hat P_r \approx 0.08\)（8% が月 10 回以上ログインする）  
   - \(\hat P_{r=0} \approx 0.15\)（15% が休眠している）  
 - → ヘビーユーザー向けには「上級者向け AI 機能を案内」、休眠ユーザー向けには「再利用促進キャンペーン」を実施。  

---

### ケース 2：有料プラン転換シミュレーション

1. **目的**  
 - 「月 5 回以上ログインする人のうち、25％ が有料プランに移行する」という仮説をもとに、売上を事前シミュレーションする。  

2. **計算手順**  
 1. \(\hat K, \hat M\) をもとに \(\hat P_r\) を算出。  
 2. \(\sum_{r=5}^\infty \hat P_r = 0.35\) と推定されたとする（仮）。  
 3. 仮に月間ユーザー数 100,000 人→そのうち 35%（=35,000 人）が月 5 回以上ログイン。  
 4. うち 25% が有料プラン転換 → 35,000 × 0.25 = 8,750 人が有料プランになる。  
 5. 月額料金 500 円を掛け合わせる → 売上予測 ¥4,375,000。  

3. **応用**  
 - 「月額 650 円に値上げ」した場合、有料転換率が 20% に下がると仮定 → 35,000 × 0.20 × 650 = ¥4,550,000。  
 - → 「値上げ vs. 転換率低下」のトレードオフを定量的に評価できる。

---

### ケース 3：休眠リスクユーザーへの施策優先度付け

1. **目的**  
 - 「次の大規模アップデートまでに、どの休眠リスクユーザーに優先してリマインド施策を打つか」を決定。  

2. **計算手順**  
 1. NBD モデルで \(\hat P_{r=0}\) を算出 → 全体の休眠率を把握。  
 2. ガンマ・ポアソン・リーセンシーモデルを使い、  
    - 最終ログインからの経過日数と頻度データから「来週中に再利用しない確率」を推定。  
 3. 「再利用しない確率が 90% 以上」のユーザー群を抽出 → 最優先ターゲットとする。  
 4. 「再利用しない確率が 70〜90% かつ有料プラン経験者」のユーザーも第二優先ターゲットとする。  
 5. それぞれのターゲットに対し、  
    - **最優先**：限定クーポン + 機能価値訴求メール  
    - **第二優先**：リマインドメール + 使い方ハウツー動画  
    などを送付。  

3. **期待される成果**  
 - 休眠リスクユーザー 2,000 人を対象に施策を実行 → リテンション率 +10%（200 人の復帰）  
 - MAU が 200 人増加 → 売上や口コミ効果の波及が期待できる。

---

## まとめ

1. **プレファレンス**  
 - ユーザーがどのタスク管理アプリを「使ってみたいか」を示す頭の中の好み。  
 - 市場規模 \(M\)、形状パラメータ \(K\)、プレファレンス比を組み合わせることで、どのブランドがどれだけ選ばれるかを確率的に推定できる。  

2. **ポアソン分布→NBD モデル**  
 - **ポアソン分布** は「平均 λ がわかっていれば、ある時間に何回起こるか」を扱うが、ユーザー間のばらつきは反映されない。  
 - **NBD モデル** は「ガンマ分布でばらつきを表現しつつポアソン過程を混合」することで、  
   \[
   P_r = \frac{\Gamma(K + r)}{\Gamma(K)\,\Gamma(r + 1)} \Bigl(\tfrac{M}{M + K}\Bigr)^r \Bigl(\tfrac{K}{M + K}\Bigr)^K
   \]
   という正規化された確率分布を導出する。  
 - これにより、ユーザーごとに「月に何回ログインするか」を確率的に推定できる。  

3. **BoxLog への応用方法**  
 - **データ収集** → **パラメータ推定（\(\hat K, \hat M\)）** → **フィットの検証** → **各種施策シミュレーション** → **モデル改善サイクル**  
 - 具体的には、  
   1. ヘビーユーザー率・休眠率の把握  
   2. 有料プラン転換予測  
   3. 休眠リスクユーザーへの復帰施策  
   4. 競合スイッチング動向のシミュレーション  
   5. プラン・価格最適化（VPP モデル）  
   6. 四半期ベースのアクティブ率・ロイヤル顧客率の把握（デリシュレー NBD）  
 - のように複数のケーススタディを通じて、BoxLog の成長を数学的にサポートできる。  

4. **6 つの数学ツール（モデル）**  
 1. **ガンマ・ポアソン・リーセンシー・モデル**：休眠リスク・LTV 推定  
 2. **負の二項分布（NBD Model）**：利用頻度分布、シェア予測、プラン転換シミュレーション  
 3. **カテゴリーの進出順位モデル**：参入順位シミュレーション、機能追加タイミング  
 4. **トライアルモデル・リピートモデル**：新機能・新プランリリース後の売上予測  
 5. **平均購入額・量モデル（VPP Model）**：プラン価格・追加課金アイテム最適化  
 6. **デリシュレー NBD モデル**：四半期アクティブ率、ヘビーユーザー率、スイッチング動向  

---

以 上、BoxLog に対して「プレファレンス」「M」「K」「NBD モデル」をはじめ、各種数学ツールを導入することで、  
- ユーザー行動の確率分布を可視化  
- マーケティング施策やプラン設計の数値シミュレーション  
- 競合シェア予測  
- 休眠リスク・LTV 分析  

など、多岐にわたる分析・施策立案を**数学的に裏付ける**ことができます。  
「ここまで複雑すぎる」と感じる場合は、まず「ガンマ・ポアソン・リーセンシー → NBD モデル」で休眠リスクと利用頻度を押さえることをオススメします。その上で徐々に「Order of Entry」「VPP」「Delishwere NBD」などの上位モデルを追加し、BoxLog の成長シナリオを数学的に強化していってください。  


